{{template "base" .}}

{{define "page-css"}}
<link rel="stylesheet" href="/styles/blog-post.css" />
{{end}}

{{define "title"}}
{{.BlogPost.Title}} | Furkan Baytekin
{{end}}

{{define "main"}}
<div class="container">
  <div class="blog-post-layout">
    <article class="blog-post">
      <!-- Cover Image -->
      <figure class="blog-post-cover">
        <img src="{{.BlogPost.Cover}}" alt="{{.BlogPost.Title}}" />
      </figure>

      <!-- Post Header -->
      <header class="blog-post-header">
        <div class="blog-post-meta">
          <span class="blog-post-category">{{.BlogPost.Category}}</span>
          <span class="blog-post-date">
            <i class="ti ti-calendar"></i>
            {{.BlogPost.Date}}
          </span>
          <span class="blog-post-read-time">
            <i class="ti ti-clock"></i>
            {{.BlogPost.ReadTime}} min read
          </span>
          <span class="blog-post-views">
            <i class="ti ti-eye"></i>
            {{.BlogPost.ViewCount}} views
          </span>
        </div>
        <h1 class="blog-post-title">{{.BlogPost.Title}}</h1>
        <p class="blog-post-excerpt">{{.BlogPost.Excerpt}}</p>
      </header>

      <!-- Post Content -->
      <div class="blog-post-content">
        {{.BlogPost.Content}}
      </div>
    </article>

    {{if .BlogPost.TOCItems}}
    <nav class="toc">
      <h2 class="toc-title">Table of Contents</h2>
      <ul class="toc-list">
        {{range .BlogPost.TOCItems}}
        <li class="toc-item toc-item--level-{{.Level}}">
          <a href="#{{.ID}}" class="toc-link">{{.Text}}</a>
        </li>
        {{end}}
      </ul>
    </nav>
    {{end}}
  </div>

  <!-- Related Posts -->
  {{if .RelatedPosts}}
  <section class="related-posts">
    <h2 class="related-posts-title">Related Posts</h2>
    <div class="related-posts-grid">
      {{range .RelatedPosts}}
      <a href="{{.Slug}}" class="related-post-card">
        <img src="{{.Cover}}" alt="{{.Title}}" class="related-post-cover" />
        <div class="related-post-content">
          <span class="related-post-category">{{.Category}}</span>
          <h3 class="related-post-title">{{.Title}}</h3>
          <span class="related-post-date">{{.Date}}</span>
        </div>
      </a>
      {{end}}
    </div>
  </section>
  {{end}}
</div>
{{end}}

{{define "footer-scripts"}}
{{if .BlogPost.TOCItems}}
<script>
(function() {
  var links = document.querySelectorAll('.toc-link');
  if (!links.length) return;

  var headingIds = [];
  links.forEach(function(link) {
    headingIds.push(link.getAttribute('href').slice(1));
  });

  var linkMap = {};
  links.forEach(function(link) {
    linkMap[link.getAttribute('href').slice(1)] = link;
  });

  var currentActive = null;

  var observer = new IntersectionObserver(function(entries) {
    entries.forEach(function(entry) {
      if (entry.isIntersecting) {
        if (currentActive) currentActive.classList.remove('active');
        var link = linkMap[entry.target.id];
        if (link) {
          link.classList.add('active');
          currentActive = link;
        }
      }
    });
  }, { rootMargin: '0px 0px -75% 0px', threshold: 0 });

  headingIds.forEach(function(id) {
    var el = document.getElementById(id);
    if (el) observer.observe(el);
  });
})();
</script>
{{end}}
{{end}}
